{-# LANGUAGE DeriveDataTypeable          #-}
{-# LANGUAGE DeriveGeneric               #-}
{-# LANGUAGE FlexibleInstances           #-}
{-# LANGUAGE NoImplicitPrelude           #-}
{-# LANGUAGE OverloadedStrings           #-}
{-# LANGUAGE StandaloneDeriving          #-}
{-# LANGUAGE TypeFamilies                #-}

{-# OPTIONS_GHC -fno-warn-unused-imports #-}

-- Module      : Network.AWS.STS.Types
-- Copyright   : (c) 2013-2014 Brendan Hay <brendan.g.hay@gmail.com>
-- License     : This Source Code Form is subject to the terms of
--               the Mozilla Public License, v. 2.0.
--               A copy of the MPL can be found in the LICENSE file or
--               you can obtain it at http://mozilla.org/MPL/2.0/.
-- Maintainer  : Brendan Hay <brendan.g.hay@gmail.com>
-- Stability   : experimental
-- Portability : non-portable (GHC extensions)

-- | The AWS Security Token Service (STS) is a web service that enables you to
-- request temporary, limited-privilege credentials for AWS Identity and
-- Access Management (IAM) users or for users that you authenticate (federated
-- users).
module Network.AWS.STS.Types
    (
    -- * Service
      STS
    -- ** XML
    , xmlOptions

    -- * AssumedRoleUser
    , AssumedRoleUser
    , mkAssumedRoleUser
    , aruAssumedRoleId
    , aruArn

    -- * Credentials
    , Credentials
    , mkCredentials
    , cAccessKeyId
    , cSecretAccessKey
    , cSessionToken
    , cExpiration

    -- * FederatedUser
    , FederatedUser
    , mkFederatedUser
    , fuFederatedUserId
    , fuArn
    ) where

import Network.AWS.Prelude
import Network.AWS.Signing.V4

-- | Supported version (@2011-06-15@) of the
-- @AWS Security Token Service@ service.
data STS deriving (Typeable)

instance AWSService STS where
    type Sg STS = V4
    data Er STS
        = ExpiredTokenException
            { _eteMessage :: Maybe Text
            }
        | IDPCommunicationErrorException
            { _idpceeMessage :: Maybe Text
            }
        | IDPRejectedClaimException
            { _idprceMessage :: Maybe Text
            }
        | InvalidAuthorizationMessageException
            { _iameMessage :: Maybe Text
            }
        | InvalidIdentityTokenException
            { _iiteMessage :: Maybe Text
            }
        | MalformedPolicyDocumentException
            { _mpdeMessage :: Maybe Text
            }
        | PackedPolicyTooLargeException
            { _pptleMessage :: Maybe Text
            }
        | STSClient HttpException
        | STSSerializer String
        | STSService String

    service = Service'
        { _svcEndpoint = Regional
        , _svcPrefix   = "sts"
        , _svcVersion  = "2011-06-15"
        , _svcTarget   = Nothing
        }

deriving instance Show    (Er STS)
deriving instance Generic (Er STS)

instance AWSError (Er STS) where
    awsError = const "STSError"

instance AWSServiceError (Er STS) where
    serviceError    = STSService
    clientError     = STSClient
    serializerError = STSSerializer

instance Exception (Er STS)

xmlOptions :: Tagged a XMLOptions
xmlOptions = Tagged def

-- | The Amazon Resource Name (ARN) and the assumed role ID, which are
-- identifiers that you can use to refer to the resulting temporary security
-- credentials. For example, you can reference these credentials as a
-- principal in a resource-based policy by using the ARN or assumed role ID.
-- The ARN and ID include the RoleSessionName that you specified when you
-- called AssumeRole.
data AssumedRoleUser = AssumedRoleUser
    { _aruAssumedRoleId :: Text
    , _aruArn :: Text
    } deriving (Show, Generic)

-- | Smart constructor for the minimum required fields to construct
-- a valid 'AssumedRoleUser' data type.
--
-- 'AssumedRoleUser' is exclusively used in responses and this constructor
-- is provided for convenience and testing purposes.
--
-- The fields accessible through corresponding lenses are:
--
-- * @AssumedRoleId ::@ @Text@
--
-- * @Arn ::@ @Text@
--
mkAssumedRoleUser :: Text -- ^ 'aruAssumedRoleId'
                  -> Text -- ^ 'aruArn'
                  -> AssumedRoleUser
mkAssumedRoleUser p1 p2 = AssumedRoleUser
    { _aruAssumedRoleId = p1
    , _aruArn = p2
    }

-- | A unique identifier that contains the role ID and the role session name of
-- the role that is being assumed. The role ID is generated by AWS when the
-- role is created.
aruAssumedRoleId :: Lens' AssumedRoleUser Text
aruAssumedRoleId =
    lens _aruAssumedRoleId (\s a -> s { _aruAssumedRoleId = a })

-- | The ARN of the temporary security credentials that are returned from the
-- AssumeRole action. For more information about ARNs and how to use them in
-- policies, see Identifiers for IAM Entities in Using IAM.
aruArn :: Lens' AssumedRoleUser Text
aruArn = lens _aruArn (\s a -> s { _aruArn = a })

instance FromXML AssumedRoleUser where
    fromXMLOptions = xmlOptions
    fromXMLRoot    = fromRoot "AssumedRoleUser"

-- | The temporary security credentials, which include an access key ID, a
-- secret access key, and a security (or session) token.
data Credentials = Credentials
    { _cAccessKeyId :: Text
    , _cSecretAccessKey :: Text
    , _cSessionToken :: Text
    , _cExpiration :: ISO8601
    } deriving (Show, Generic)

-- | Smart constructor for the minimum required fields to construct
-- a valid 'Credentials' data type.
--
-- 'Credentials' is exclusively used in responses and this constructor
-- is provided for convenience and testing purposes.
--
-- The fields accessible through corresponding lenses are:
--
-- * @AccessKeyId ::@ @Text@
--
-- * @SecretAccessKey ::@ @Text@
--
-- * @SessionToken ::@ @Text@
--
-- * @Expiration ::@ @ISO8601@
--
mkCredentials :: Text -- ^ 'cAccessKeyId'
              -> Text -- ^ 'cSecretAccessKey'
              -> Text -- ^ 'cSessionToken'
              -> ISO8601 -- ^ 'cExpiration'
              -> Credentials
mkCredentials p1 p2 p3 p4 = Credentials
    { _cAccessKeyId = p1
    , _cSecretAccessKey = p2
    , _cSessionToken = p3
    , _cExpiration = p4
    }

-- | The access key ID that identifies the temporary security credentials.
cAccessKeyId :: Lens' Credentials Text
cAccessKeyId = lens _cAccessKeyId (\s a -> s { _cAccessKeyId = a })

-- | The secret access key that can be used to sign requests.
cSecretAccessKey :: Lens' Credentials Text
cSecretAccessKey =
    lens _cSecretAccessKey (\s a -> s { _cSecretAccessKey = a })

-- | The token that users must pass to the service API to use the temporary
-- credentials.
cSessionToken :: Lens' Credentials Text
cSessionToken = lens _cSessionToken (\s a -> s { _cSessionToken = a })

-- | The date on which the current credentials expire.
cExpiration :: Lens' Credentials ISO8601
cExpiration = lens _cExpiration (\s a -> s { _cExpiration = a })

instance FromXML Credentials where
    fromXMLOptions = xmlOptions
    fromXMLRoot    = fromRoot "Credentials"

-- | Identifiers for the federated user associated with the credentials (such as
-- arn:aws:sts::123456789012:federated-user/Bob or 123456789012:Bob). You can
-- use the federated user's ARN in your resource-based policies, such as an
-- Amazon S3 bucket policy.
data FederatedUser = FederatedUser
    { _fuFederatedUserId :: Text
    , _fuArn :: Text
    } deriving (Show, Generic)

-- | Smart constructor for the minimum required fields to construct
-- a valid 'FederatedUser' data type.
--
-- 'FederatedUser' is exclusively used in responses and this constructor
-- is provided for convenience and testing purposes.
--
-- The fields accessible through corresponding lenses are:
--
-- * @FederatedUserId ::@ @Text@
--
-- * @Arn ::@ @Text@
--
mkFederatedUser :: Text -- ^ 'fuFederatedUserId'
                -> Text -- ^ 'fuArn'
                -> FederatedUser
mkFederatedUser p1 p2 = FederatedUser
    { _fuFederatedUserId = p1
    , _fuArn = p2
    }

-- | The string that identifies the federated user associated with the
-- credentials, similar to the unique ID of an IAM user.
fuFederatedUserId :: Lens' FederatedUser Text
fuFederatedUserId =
    lens _fuFederatedUserId (\s a -> s { _fuFederatedUserId = a })

-- | The ARN that specifies the federated user that is associated with the
-- credentials. For more information about ARNs and how to use them in
-- policies, see Identifiers for IAM Entities in Using IAM.
fuArn :: Lens' FederatedUser Text
fuArn = lens _fuArn (\s a -> s { _fuArn = a })

instance FromXML FederatedUser where
    fromXMLOptions = xmlOptions
    fromXMLRoot    = fromRoot "FederatedUser"
